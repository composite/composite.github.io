<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>JS for LINK</title>
    <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.2.0/cosmo/bootstrap.min.css" rel="stylesheet">
    <style>
        #editor{height:360px;}
        #linktext{cursor:text;}
        #linkframe{height:240px}
        #errorbox{display: none;}
    </style>
</head>
<body>
    <header class="container">
        <h1 class="page-header">JS4Link</h1>
        <p class="lead">Convert your javascript to javascript:protocol link, one click, run anywhere.</p>
    </header>
    <section class="container">
        <h3>Insert yout script</h3>
        <div id="editor">//Insert your code here.</div>
        <hr/>
        <button type="button" id="compile" class="btn btn-primary">Generate</button>
        <button type="button" id="example" class="btn btn-default">Example Script</button>
        <br/><br/>
        <div id="errorbox" class="alert alert-danger" role="alert" style="display: none"><strong>Error! (<span>0</span>, <span>0</span>)</strong> <span></span></div>
        <h3>See in your eyes.</h3>
        <form action="#" class="form-horizontal" role="form">
            <div class="form-group">
                <label for="linktext" class="col-sm-2 control-label">Href:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="linktext" placeholder="Your script link" readonly>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><button id="addb" type="button" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-star"></span> Bookmark</button></label>
                <div class="col-sm-10">
                    <a id="linka" href="#" class="form-control" target="linker">Your script link here.</a>
                </div>
            </div>
            <div class="form-group">
                <label for="linkframe" class="col-sm-2 control-label">Run preview:</label>
                <div class="col-sm-10">
                    <iframe class="form-control" id="linkframe" name="linker" src="play.html" frameborder="0"></iframe>
                </div>
            </div>
        </form>
        <h3>Credits</h3>
        <ul>
            <li>Composite: (<a href="http://hazard.kr">http://hazard.kr</a>)</li>
            <li>jQuery: (<a href="http://jquery.com">http://jquery.com</a>)</li>
            <li>Bootstrap: (<a href="http://getbootstrap.com">http://getbootstrap.com</a>)</li>
            <li>Cosmo theme: (<a href="http://bootswatch.com/cosmo/">http://bootswatch.com/cosmo/</a>)</li>
            <li>ACE Editor: (<a href="http://ace.c9.io/">http://ace.c9.io/</a>)</li>
            <li>uglifyJS for browser: (<a href="https://github.com/Trenker/Browser-UglifyJS">https://github.com/Trenker/Browser-UglifyJS</a>)</li>
        </ul>
    </section>
    <footer class="container">
        <hr/>
        <p>&copy; 2014 Composite</p>
    </footer>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="//cdn.rawgit.com/Trenker/Browser-UglifyJS/master/build/uglifyjs.1.2.5.min.js"></script>
    <script src="//cdn.jsdelivr.net/ace/1.1.5/min/ace.js"></script>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.getSession().setMode("ace/mode/javascript");
        $(function(){
            $('#compile').on('click', function(){
                try{
                    var min = 'javascript:void((function(){' + uglify(editor.getValue()) + '})())';
                    $('#errorbox').hide();
                }catch(E){
                    var lc = ['line', 'col'];
                    $('#errorbox').show().children()
                            .eq(0).children().each(function(i){$(this).text(E[lc[i]]);}).end().end()
                            .eq(1).text(E.message);
                    console.log(E);
                    return;
                }
                $('#linktext').val(min);
                $('#linka').attr('href',min);
            });
            $('#example').on('click',function(){
                $.get('example.js',function(d){editor.setValue(d);},'text');
            });
            $('#linktext').on('click',function(){this.select();});
            $('#addb').on('click', function(){
                var href = $('#linka').attr('href');
                if (window.sidebar && window.sidebar.addPanel) { // Mozilla Firefox Bookmark
                    window.sidebar.addPanel('Generated by' + document.title,href,'');
                } else if(window.external && ('AddFavorite' in window.external)) { // IE Favorite
                    window.external.AddFavorite(href,'Generated by' + document.title);
                } else if(window.opera && window.print) { // Opera Hotlist
                    this.title='Generated by' + document.title;
                    return true;
                } else { // webkit - safari/chrome
                    prompt("Sorry. Safari and chrome doesn't support bookmark.\nyou can add bookmark manual with script url below:",href);
                }
            });
        });
    </script>
</body>
</html>